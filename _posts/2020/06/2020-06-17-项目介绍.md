---
layout: post 
author: oshacker
title: 【大型电商项目】项目介绍
category: project
tags: [project]
excerpt: 千万级项目从0到1到100（一）
---


该项目从单体电商项目开始，逐步地演进项目架构和技术解决方案，到集群、分布式、微服务和容器化，最终打造一个高可用、高并发、高性能的大型互联网项目，真实感受一个千万级别的项目从0到1，再到100的成长过程。

该项目包含大部分Java常用技术栈：Spring Boot、Mybatis、Redis、Nginx、ES搜索引擎、FastDFS文件存储、分布式会话、单点登陆、RabbitMQ消息队列、Kafka消息队列、MyCAT、Sharding-JDBC、分布式锁设计、分布式全局ID设计、分布式事务和数据的一致性、接口幂等性设计、分布式限流、SpringCloud G版微服务、Docker、K8S、容器弹性扩缩容、Netty、JVM性能调优、MySQL性能调优、应用程序性能调优、Tomcat性能调优、Linux性能调优、架构调优

项目整体的开发安排如下：
+ 1-5周：单体项目开发与上线
+ 6-8周：从单体到高可用集群演进
+ 9-17周：逐个解决分布式核心问题
+ 18-25周：SpringCloud G版微服务
+ 26-30周：Docker、K8S容器化
+ 31-40周：Netty、JVM、Tomcat、Linux、系统架构等方面的性能调优

## 大型网站的特点

大型网站不仅访问量大，而且数据体量很大。下面对比大型和非大型网站：
+ 类似上网导航hao123这样网站，它们都是提供一个静态网页（可通过模版技术生成），用户点击时跳转到其他的网站，即根据用户的访问需求提供了一种综合的网站分类推荐服务。虽然这类网站的用户访问量非常巨大，但是这些网站本身并没有庞大的数据量，它们和用户的交互都是单向的，网站自身编辑内容提供给用户访问，用户只需要点击浏览即可，这样的网站相当于Web1.0时代的小型网站。
+ 像淘宝和京东这样的网站，它们不仅都具有庞大的访问量，而且网站的数据体量也非常庞大，拥有海量数据，并且可以支持大数据分析。比如每年年底都能通过大数据分析知道你花了多少钱，都买了什么，预计明年会买什么等等，这些都是大型网站的基本特征。

大型互联网站的特点：
+ 高并发，大流量：一个网站从小做到大，业务越来越大，积累的用户也越来越多，那么网站的请求量势必越来越大。比如百度日均访问达到50亿+。
+ 高可用：这是大型网站必须达到的标准，所谓高可用就是确保网站7x24小时不间断稳定地向用户提供服务，哪怕有服务器节点宕机了，这个时候备用机会替换当前不可用的服务器节点，确保服务正常访问。
+ 大数据：通过大量服务器以及存储系统管理海量数据，数据多了，就可以做大数据分析。比如为每个用户画像，分析用户购买习惯，预计用户未来会购买的商品；再比如当你上传了图片，网站会通过人工智能来分析图片数据，不论人物图、风景图还是宠物图，都会做到精确的分析。
+ 敏捷开发，迭代快：大型网站的用户量很大，为了提高用户体验，优化用户各类操作，各种需求会被产品经理提出，通过头脑风暴、研讨会等方式角逐出一些非常好用的功能模块；开发人员根据需求快速迭代，测试与运维也会跟进。一般1-2周会快速迭代一次。
+ 用户体系庞大：大型网站的用户量很大，这些用户不可能都分布在同一地区，而是分布在全国，乃至世界各地。
+ 可持续升级：大型网站都是从最初的最简单版本一步步迭代出来的，而不是一上来就搞一个tps达千万级的高大上的架构。
+ 安全防范：网站越大就越会有黑客或同行来攻击，比如网站被黑客攻击勒索比特币，出现问题的原因往往是服务器漏洞，比如上传图片没有限制文件类型，只在前端判断，没有在后端判断，导致黑客可以直接攻击API接口，把可植入脚本上传到服务器运行。
+ 弹性扩展：淘宝双11在并发量剧增时，可以通过增加服务器来扩容，从而引导剧增的流量；微博上某明星热搜导致流量剧增，服务器动态增加来实现动态扩容，不需要的时候适当减少服务器。
+ 吞吐量高，响应速度快：系统数据量一旦大了，它的响应速度会比较慢，影响用户体验。因此，大型网站必须保证用户每次请求的响应是很快的。

## 大型网站的设计宗旨

开发过程中，项目架构的设计需要注意以下几点：
+ 合久必分：MVC模式把系统拆分为model、view、controller，通过不同的包名进行区分和分层。分层是一种常见架构模式，不论用什么语言都会面临分层，而且分层也便于代码的解耦以及合理的工作分配。
+ 集群：集群是高可用和负载均衡的手段，多台部署相同应用的服务器节点构成一个集群，保证负载均衡的同时提升系统的可用性，互相灾备。
+ CDN：大型网站的用户分散在全国或世界各地，采用CDN后，不论用户在哪里都能访问到最近的服务节点，这样不会因为距离而使得用户请求响应速度变慢。
+ 分布式系统：大型网站一定是由多系统、多模块、多中间件、多服务器等共同协同整合的一个整体。在分布式领域，我们会接触到分布式架构、分布式文件系统、分布式锁、分布式事务、分布式配置、分布式限流、日志收集等，
+ 异步：异步是一种最常见的优化用户体验的方式。前端可以采用Ajax异步调用，减少页面刷新；后端采用生产者-消费者模式对代码进行结构，所以就使用到了消息队列，比如RabbitMQ、RocketMQ、Kafka等，合理使用消息队列，可以在高并发时进行流量削峰。
+ 业务分离：大型网站的业务很多，比如用户、订单、商品、支付等，这些模块可以合理的进行分离，让某个专门的团队独立负责一个子系统或自服务，在微服务中就会用到。
+ 数据备份：大型网站多服务器运维的情况下，某个节点宕机是很常见的，一旦宕机，重要的是做好数据的备份，不能因为宕机而导致数据丢失。所以，需要定期为数据库做好冷热备份，做好主从，实现系统的高可用（运维工程师的工作）。

## 大型网站架构演进历程

在web 1.0时代，用户通过在浏览器中输入相应的网址来打开相应的网站，如下图。这时候的网站往往都是静态页面，仅仅包含html、js和css样式，服务器和用户的交互都是单向的，即服务器提供给用户相应的内容，用户点击浏览。

![](https://www.coderap.cn/assets/images/2020/06/pr1.png)

进入web 2.0时代，用户通过浏览器去访问服务器，服务器也包含了相应的内容，但是会有数据库，如下图，用户和服务器之间交互是双向的，用户可以增删改查相应的数据，这些数据都会保存到数据库中。

![](https://www.coderap.cn/assets/images/2020/06/pr2.png)

随后，发展到了单体架构，网站的早期没有多少人访问，因此只需要一台服务器就可以了。所谓单体架构是指应用程序开发完后，部署在应用服务器上，且应用程序访问自己服务器上文件服务器（文件系统比较好），访问自己服务器的数据库。单体架构是早期传统的Java Web的开发模式。

![](https://www.coderap.cn/assets/images/2020/06/pr3.png)

随着网站业务的发展，用户越来越多，一台服务器是不能够满足所有用户的访问需求的，即流量越来越大，服务器的性能越来越差，最常见的问题是服务器的空间不足。单体一旦宕机，所有的文件和数据库数据都将无法访问，解决方案是应用程序、文件服务器、数据库部署在不同的服务器上，各自提供不同的服务，如下图。分开部署的好处是从一台服务器变成了3台服务器，相应的处理能力就提升了3倍，文件系统和数据库的空间也有了一定增加。此外，如果网站服务器挂了，文件系统和数据库所在服务器仍然可以被正常访问。

![](https://www.coderap.cn/assets/images/2020/06/pr4.png) 

随着时间的推移，用户成倍的增加，分开部署的架构又会遇到数据库访问压力大的问题，导致用户请求响应的延迟。这是因为大量用户的查询请求落在数据库上，这个时候的解决方案是引入缓存中间件（一种防护机制）。用户进行数据查询时，会先去访问缓存中间件，如果有相应的数据，那么直接返回，如果没有，才会去访问数据库。如果用户的请求响应变慢，用户体验变差，很可能会导致一定量用户的流失，所以很有必须要引入缓存中间件，来加快请求响应的速度，提升用户体验。

![](https://www.coderap.cn/assets/images/2020/06/pr5.png) 

目前，所有的服务都是单节点部署，如果用户流量很大，可能会导致某个节点宕机，用户无法访问，这对于企业来讲是一种毁灭性的打击，因此单节点部署成为了网站的瓶颈，解决方案是引入集群、负载均衡。所谓集群是指，以tomcat集群为例，相同的应用程序在多个tomcat中各部署一份，如下图。通过负载均衡将tomcat服务器部署为一个集群，可以提升整个应用程序的请求处理能力。负载均衡算法在后面的文章中会详细介绍。从下图中可知，不仅仅网站（应用服务器）可以构成一个集群，文件服务器、缓存也是可以部署为集群的。

![](https://www.coderap.cn/assets/images/2020/06/pr6.png) 